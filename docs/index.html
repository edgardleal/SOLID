<!DOCTYPE html>
<html>
  <head>
    <title>SOLID</title>
    <meta charset="utf-8">
    <style>
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body { font-family: 'Droid Serif'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
    </style>
	<link rel="stylesheet"
      href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/styles/default.min.css">
<style>

span.left img {
  width: 130px;
}

</style>
  </head>
  <body>
    <textarea id="source">

class: center, middle

```
   _____    ____    _        _____   _____  
  / ____|  / __ \  | |      |_   _| |  __ \ 
 | (___   | |  | | | |        | |   | |  | |
  \___ \  | |  | | | |        | |   | |  | |
  ____) | | |__| | | |____   _| |_  | |__| |
 |_____/   \____/  |______| |_____| |_____/ 
                                            
```

---

# Agenda

1.  O que é SOLID
2.  Problemas de não termos SOLID
2.  Vantagens
3.  Desvantagens
5.  Uma estruturação diferente para o SOLID
9.  Interface segregation
10. Dependency Inversion
8.  Liskov Subsctitution Principle
7.  Open Close
6.  Single Responsability

???
Reordenar

---

# O que é SOLID ?

## S - Single Responsability
## O - Open Close
## L - Liskov Subsctitution Principle 
## I - Interface Segregation
## D - Dependency Inversion

???
Definição básica de cada item

---

# Desvantagens

### Verbosidade
### Complexidade ?
> "É melhor ficar  travado no test do que travar o time todo" - James

### Boilerplate
### Orientação a Objetos

???
Ressaltar a complexidade expalhada

---

# Vantagens

### Facilidade de uso com Arquitetura Limpa

### Reutilização de código

### Testabilidade

???
Link para a apresentação de James no final

---

# Na prática

## Separando as coisas

### SOL 🌞 

.left[![Lights](https://raw.githubusercontent.com/edgardleal/SOLID/master/docs/img/lights.jpeg)]

### LID

.left[![Lights](https://raw.githubusercontent.com/edgardleal/SOLID/master/docs/img/men-working.jpg)]

---

# Problemas que podem ser resolvidos

```js
function getUsers() {
  return axios.get('/users');
}
```

## Problemas com esta implementação

* Falta tratamento de erro
* Se receber 404 retorna null?
* Se receber 502/503/504 tenta novamente?

### Isso é comum ?

```
ag 'axios.get\(' | wc -l
```

#### Resultado

* 62 dentro de casinha
* 215 dentro dos projetos da sanar ( em minha máquina )

???
Vantagens e Desvantagens da simplicidade

---

# Nova estrutura


```
   _____    ____    _        _____   _____  
|_   _| |  __ \   / __ \  | |       / ____|
  | |   | |  | | | |  | | | |      | (___  
  | |   | |  | | | |  | | | |       \___ \ 
 _| |_  | |__| | | |__| | | |____   ____) |
|_____| |_____/   \____/  |______| |_____/ 
                                            
```

---

![American Idols](https://raw.githubusercontent.com/edgardleal/SOLID/master/docs/img/idols.jpg)]

---

---

# Vantagens

## Manutenibilidade

## Reuso de código

## Facilidade de compreenção do código

---

# Desvantagens

---

# S => Responsabilidade Única

## Único

* Um endpoint executa muitiplas ações

## Conciso

> "reduzido ao essencial; em poucas palavras (diz-se de escritos, ideias, discurso etc.); preciso, sucinto, resumido."


---

# Responsabilidade de Negocio vs Responsabilidade de Codigo

![Árvore de Chamadas](https://edgardleal.github.io/SOLID/img/function_call_tree.png)

---

# V1 - Implementação inicial

```

const express = require('express');
const axios = require('axios');

const server = express();

const PORT = process.env.PORT || 3000;

server.get('/users', (req, res) => {
  axios.get('http://users:3000/')
    .then(res.json)
    .catch(res.json);
});

server.listen(PORT, (err) => {
  if (err) {
    console.error(err);
  }
  console.log(`Listeining on port ${PORT}`);
});

```

---

# V2 - Implementando a Resiliência

```

server.get('/users', (req, res) => {
  const instance = axios.create({
    baseURL: 'http://users:3000',
    timeout: 800,
  });
  instance.get('/')
    .then(response => response.data)
    .then(res.json.bind(res))
    .catch((error: AxiosError) => {

      const retry = () => {
        return instance.get('/').then(response => response.data);
      };
      console.error(error.message);

      retry().then(res.json.bind(res)).catch(e => {
        retry().then(res.json.bind(res)).catch(error => {
          res.status((error.response || { status: 500 }).status);
          console.error(error.message);
          res.end(error.message);
        });
      });
    });
});

```

---

# L - Princípio da Substituição de Liskov

![LID](https://raw.githubusercontent.com/edgardleal/SOLID/master/docs/img/Liskov_DI_IS.jpg)

---

exclude: true

# V3 - Dividindo as Responsabilidades

```typescript
let _instance;
function getInstance() {
  if (!_instance) {
    _instance = axios.create({
      baseURL: 'http://users:3000',
      timeout: 800,
    });
  }
  return _instance;
}

function tryRequest(req, res, tries = 0) {
  return getInstance().get('/')
    .then(res.json.bind(res))
    .catch((error: AxiosError) => {
      if (tries < 20) {
        tryRequest(req, res, tries + 1);
      } else {
        res.status((error.response || { status: 500 }).status);
        res.end(error.message);
      }
    });
}
server.get('/users', tryRequest);
```

---

exclude: true

# Multi Responsabilidades


```typescript
import mysql from "mysql";

export interface IUserData {
  name: string;
  address: string;
  email: string;
}
export async function registerNewClient(data: IUserData): Promise<IUserData> {
  const con = mysql.createConnection({
    host: "localhost",
    user: "root",
    password: "123456",
    database: "test"
  });
  return new Promise<IUserData>((resolve, reject) => {
    con.connect(function(err) {
      if (err) return reject(err);
      console.log("Connected!");
      const { name, address, email } = data;
      const sql = `INSERT INTO customers (name, address, email) VALUES ('${name}', '${address}', '${email}')`;
*      con.query(sql, function(err) {
        if (err) return reject(err);
        console.log("1 record inserted");
        resolve(data);
      });
    });
  });
}

```

---

exclude: true

# Responsabilidade Única


```typescript
import { MysqlDatasource } from "./MysqlDatasource";

export interface IUserData {
  name: string;
  address: string;
  email: string;
}
export async function registerNewClient(data: IUserData): Promise<IUserData> {
  const { name, address, email } = data;
  const sql = `INSERT INTO customers (name, address, email)
         VALUES ('${name}', '${address}', '${email}')
  `;
  return new MysqlDatasource().executeQuery(sql);
}

---

# Referencias

### Arquitetura limpa 

* https://pt.slideshare.net/jamersonweb/arquitetura-limpa-131970246

```

# Introduction

</textarea>
    <script src="https://remarkjs.com/downloads/remark-latest.min.js">
	<script
	 charset="UTF-8"
	 src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.9/languages/go.min.js"></script>
	<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/highlight.min.js"></script>
    </script>
    <script>
      // leve => tomorrow
      // power => sunburst
      // arta idea magula rainbow vs
      var style = 'googlecode';
      var slideshow = remark.create({
        highlightLanguage: 'typescript',
        highlightLines: true,
        highlightStyle: style,
      });
    </script>
  </body>
</html>
